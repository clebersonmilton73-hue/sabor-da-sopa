
<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin - Sabor da Sopa</title>
<style>
  :root{
    --bg:#050814; --card:#0f172a; --line:rgba(148,163,184,.16); --txt:#e2e8f0; --muted:#94a3b8;
    --good:#22c55e; --bad:#ef4444; --shadow:0 12px 28px rgba(0,0,0,.35); --radius:18px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#07101f,#050814);color:var(--txt)}
  .wrap{max-width:1400px;margin:28px auto 80px;padding:0 26px}
  .panel{background:rgba(15,23,42,.86);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
  .hd{padding:14px 14px;border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between;gap:10px}
  .hd b{font-size:14px}
  .grid{padding:24px;display:grid;grid-template-columns:420px 1fr;gap:24px}
  @media(max-width:980px){.wrap{padding:0 14px}.grid{grid-template-columns:1fr;padding:16px;gap:16px}}
  .card{background:rgba(2,6,23,.55);border:1px solid var(--line);border-radius:16px;padding:12px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .row>*{flex:1}
  .input,.select{width:100%;background:rgba(2,6,23,.55);border:1px solid var(--line);border-radius:16px;padding:14px 16px;color:var(--txt);font-weight:900;font-size:15px}
  .btn{border:none;border-radius:16px;padding:14px 16px;font-weight:1000;cursor:pointer;font-size:15px}
  .btn.primary{background:linear-gradient(180deg,#60a5fa,#3b82f6);color:#081426}
  .btn.good{background:linear-gradient(180deg,#34d399,#22c55e);color:#05210f}
  .btn.ghost{background:rgba(148,163,184,.10);border:1px solid var(--line);color:var(--txt)}
  .muted{color:var(--muted);font-weight:800}
  .pill{display:inline-flex;align-items:center;gap:8px;background:rgba(148,163,184,.10);border:1px solid var(--line);padding:8px 10px;border-radius:999px;font-weight:900}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid rgba(148,163,184,.14);padding:14px 10px;text-align:left;font-weight:900}
  th{color:var(--muted);font-size:12px}
  td small{color:var(--muted);font-weight:800}
  .danger{color:var(--bad)}
  .ok{color:var(--good)}

  .thumb{width:52px;height:40px;object-fit:cover;border-radius:10px;border:1px solid rgba(148,163,184,.20)}

  /* ===== Cards de Produtos ===== */
  .prodGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
  .prodCard{background:rgba(2,6,23,.55);border:1px solid var(--line);border-radius:16px;overflow:hidden;display:grid}
  .prodImg{width:100%;height:150px;object-fit:cover;background:rgba(2,6,23,.35)}
  .prodPad{padding:12px;display:grid;gap:8px}
  .prodTop{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
  .prodName{font-size:14px;font-weight:1000;line-height:1.2}
  .prodMeta{color:var(--muted);font-weight:800;font-size:12px}
  .prodPrice{font-weight:1100}
  .prodActions{display:flex;gap:8px;flex-wrap:wrap}
  .btn.sm{padding:10px 12px;border-radius:14px;font-size:14px}
  @media(max-width:520px){
    .prodGrid{grid-template-columns:1fr}
    .prodImg{height:160px}
  }


  
  .mobBar{display:none}
  @media(max-width:980px){.mobBar{display:flex}}

  /* ===== ERP Layout ===== */
  .erpShell{display:flex;min-height:calc(100vh - 0px);gap:0}
  .side{
    width:320px;flex:0 0 320px;
    border-right:1px solid rgba(148,163,184,.14);
    background:rgba(2,6,23,.35);
    padding:18px 16px;
    position:sticky;top:0;align-self:flex-start;height:calc(100vh - 0px);
    overflow:auto
  }
  .main{flex:1;min-width:0;padding:18px 18px 26px}
  .navTitle{font-size:12px;color:var(--muted);font-weight:900;margin:4px 0 10px}
  .navBtn{
    width:100%;text-align:left;
    display:flex;align-items:center;justify-content:space-between;gap:10px;
    padding:12px 12px;border-radius:14px;
    background:rgba(148,163,184,.08);
    border:1px solid rgba(148,163,184,.12);
    color:var(--txt);font-weight:1000;cursor:pointer
  }
  .navBtn + .navBtn{margin-top:10px}
  .navBtn.active{background:rgba(96,165,250,.18);border-color:rgba(96,165,250,.32)}
  .topbar{
    display:flex;align-items:center;justify-content:space-between;gap:12px;
    padding:14px 14px;border:1px solid rgba(148,163,184,.14);
    background:rgba(2,6,23,.25);
    border-radius:16px
  }
  .topbar .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
  .section{margin-top:16px}
  .sectionHd{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;margin-bottom:10px}
  .sectionHd b{font-size:14px}
  .hide{display:none !important}

  /* full-width wrap/panel */
  .wrap{width:100%;max-width:100%;margin:0;padding:0}
  .panel{border-radius:0;min-height:100vh}
  .grid{padding:0;grid-template-columns:1fr} /* we control layout ourselves */
  @media(max-width:980px){
    .side{position:fixed;left:0;top:0;height:100vh;z-index:40;transform:translateX(-102%);transition:.18s ease;box-shadow:0 20px 50px rgba(0,0,0,.55)}
    .side.open{transform:translateX(0)}
    .main{padding:14px}
    .mobBar{display:flex;gap:10px;align-items:center;margin-bottom:10px}
    .mobBtn{padding:12px 14px;border-radius:14px;border:1px solid rgba(148,163,184,.14);background:rgba(148,163,184,.10);color:var(--txt);font-weight:1000;cursor:pointer}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:35;display:none}
    .overlay.show{display:block}
  }


  /* ===== Mobile (Admin) ===== */
  @media(max-width:980px){
    .top{padding:12px}
    .pill{max-width:70vw;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .topbar{flex-direction:column;align-items:stretch}
    .topbar .actions{justify-content:stretch}
    .topbar .actions .btn{width:100%}
    .card{padding:14px}
    .row{flex-direction:column}
    .row>*{flex:unset}
    .prodGrid{grid-template-columns:1fr;gap:12px}
    .prodPad{padding:14px}
    .prodActions{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .btn.sm{width:100%}
    .main{padding:14px}
    .side{width:86vw;max-width:360px}
  }
  @media(max-width:420px){
    .prodActions{grid-template-columns:1fr}
  }


  .statusP{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;
    border:1px solid rgba(148,163,184,.14);background:rgba(148,163,184,.08);font-weight:1000;font-size:12px}
  .statusP.on{background:rgba(34,197,94,.16);border-color:rgba(34,197,94,.30)}
  .statusP.off{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.28)}
  .searchRow{display:flex;gap:10px;flex-wrap:wrap}
  .searchRow > *{flex:1;min-width:160px}

</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <div class="hd">
      <div>
        <b>üõ°Ô∏è Admin - Sabor da Sopa</b>
        <div class="muted" style="font-size:12px">Login com Firebase Auth + bloqueio ap√≥s 3 tentativas</div>
      </div>
      <div class="pill" id="pill">üîí desconectado</div>
    </div>

    <div class="grid">
      <div class="card" id="loginCard">
        <b>Entrar</b>
        <div class="muted" style="margin-top:6px;font-size:12px">Use seu email/senha do Firebase Authentication.</div>

        <div style="margin-top:12px;display:grid;gap:10px">
          <input id="user" class="input" placeholder="Email" autocomplete="username">
          <input id="pass" class="input" type="password" placeholder="Senha" autocomplete="current-password">
          <button class="btn primary" onclick="entrar()">Entrar</button>
          <div class="muted" id="lockInfo" style="font-size:12px"></div>
        </div>
      </div>

      <div class="card" id="panelCard" style="display:none">
        <div class="erpShell">
          <div class="overlay" id="ovl" onclick="toggleSide(false)"></div>

          <aside class="side" id="side">
            <div class="navTitle">Navega√ß√£o</div>
            <button class="navBtn active" id="navProdutos" onclick="showView('produtos')">üßæ Produtos <span class="muted" id="countProdutos"></span></button>
            <button class="navBtn" id="navPedidos" onclick="showView('pedidos')">üßæ Pedidos <span class="muted" id="countPedidos"></span></button>

            <div class="navTitle" style="margin-top:16px">A√ß√µes</div>
            <button class="navBtn" onclick="exportarCSV()">‚¨áÔ∏è Exportar CSV</button>
            <button class="navBtn" onclick="sair()">üö™ Sair</button>

            <div class="muted" style="font-size:12px;margin-top:14px;line-height:1.35">
              Dica: no celular, toque em ‚ÄúMenu‚Äù para abrir a lateral.
            </div>
          </aside>

          <main class="main">
            <div class="mobBar">
              <button class="mobBtn" onclick="toggleSide(true)">‚ò∞ Menu</button>
              <div class="muted" style="font-weight:900">Admin</div>
            </div>

            <div class="topbar">
              <div>
                <b>Painel</b>
                <div class="muted" style="font-size:12px">Gerencie produtos e visualize pedidos.</div>
              </div>
              <div class="actions">
                <button class="btn ghost" onclick="exportarCSV()">Exportar CSV (pedidos)</button>
                <button class="btn ghost" onclick="sair()">Sair</button>
              </div>
            </div>

            <!-- VIEW: PRODUTOS -->
            <section class="section" id="viewProdutos">
              <div class="card" style="margin-top:12px">
                <div class="sectionHd" style="margin:0 0 8px 0">
                  <b>Buscar / Filtrar</b>
                  <div class="muted" style="font-size:12px">Encontra produtos r√°pido</div>
                </div>
                <div class="searchRow">
                  <input id="qBusca" class="input" placeholder="Buscar por nome...">
                  <input id="qCat" class="input" placeholder="Filtrar por categoria (opcional)">
                  <select id="qAtivo" class="select">
                    <option value="TODOS">Todos</option>
                    <option value="ATIVOS">Somente ativos</option>
                    <option value="INATIVOS">Somente inativos</option>
                  </select>
                </div>
              </div>

              <div class="sectionHd">
                <b>Produtos</b>
                <div class="muted" style="font-size:12px">Somente admin edita (rules).</div>
              </div>

              <div class="card" style="margin-bottom:14px">
                <b>Criar / Editar produto</b>

                <div style="margin-top:12px" class="row">
                  <input id="pId" class="input" placeholder="ID num√©rico (ex: 101)">
                  <input id="pCat" class="input" placeholder="Categoria">
                </div>
                <div style="margin-top:10px" class="row">
                  <input id="pNome" class="input" placeholder="Nome do produto">
                  <input id="pPreco" class="input" placeholder="Pre√ßo" inputmode="decimal">
                </div>

                <div style="margin-top:10px">
                  <input id="pFotoURL" class="input" placeholder="Link direto da imagem (https://... .jpg/.png/.webp)">
                </div>

                <div style="margin-top:10px" class="row" style="align-items:center">
                  <label class="muted" style="display:flex;align-items:center;gap:10px;font-size:13px">
                    <input type="checkbox" id="pAtivo" checked style="transform:scale(1.1)"> Produto ativo (aparece no card√°pio)
                  </label>
                </div>

                <div style="margin-top:10px">

                  <div class="muted" style="font-size:12px;margin-top:6px">Use link direto da imagem. Ex: termina com .jpg / .png / .webp</div>
                </div>

                <div style="margin-top:10px" class="row">
                  <input id="pOrd" class="input" placeholder="Ordem (opcional)" inputmode="numeric">
                  <button class="btn good" onclick="salvarProduto()">Salvar/Atualizar</button>
                </div>
              </div>

              <div id="prodCards" class="prodGrid"></div>
            </section>

            <!-- VIEW: PEDIDOS -->
            <section class="section hide" id="viewPedidos">
              <div class="sectionHd">
                <b>Pedidos</b>
                <div class="muted" style="font-size:12px">Clientes criam, mas n√£o leem. Admin l√™.</div>
              </div>

              <div class="card" style="overflow:auto">
                <table>
                  <thead><tr><th>Data</th><th>Cliente</th><th>Total</th><th>Tipo</th><th>Obs</th></tr></thead>
                  <tbody id="tbPed"></tbody>
                </table>
              </div>
            </section>

          </main>
        </div>
</div>
        </div>

      </div>
    </div>
  </div>

  <div class="muted" style="margin-top:14px;font-size:12px">
    ‚úÖ Senha ‚Äúcriptografada‚Äù: no Firebase Auth, senhas s√£o armazenadas com hash/seguran√ßa do servidor (voc√™ n√£o guarda a senha em arquivo).<br>
    üõ°Ô∏è O bloqueio ap√≥s 3 tentativas √© local (neste navegador) para evitar for√ßa bruta r√°pida.
  </div>
</div>

<script type="module">
import { firebaseConfig, ADMIN_EMAILS } from "./firebase-config.js";
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, doc, setDoc, deleteDoc, getDocs, query, orderBy, limit, updateDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const pill = document.getElementById("pill");
const loginCard = document.getElementById("loginCard");
const panelCard = document.getElementById("panelCard");
const lockInfo = document.getElementById("lockInfo");

const LOCK_KEY = "SABOR_ADMIN_LOCK_v1";

function now(){ return Date.now(); }
function getLock(){
  try{ return JSON.parse(localStorage.getItem(LOCK_KEY) || "{}"); }catch(e){ return {}; }
}
function setLock(o){ localStorage.setItem(LOCK_KEY, JSON.stringify(o||{})); }
function isLocked(){
  const l = getLock();
  if(!l.until) return false;
  return now() < l.until;
}
function lockMsg(){
  const l = getLock();
  if(!l.until) return "";
  const sec = Math.max(0, Math.ceil((l.until - now())/1000));
  return sec ? `Bloqueado por ${sec}s (ap√≥s 3 tentativas).` : "";
}
function resetAttempts(){ setLock({attempts:0, until:0}); }

function showLockUI(){
  lockInfo.textContent = lockMsg();
  lockInfo.className = "muted";
  if(isLocked()) lockInfo.className = "muted danger";
}
setInterval(showLockUI, 500);

async function entrar(){
  if(isLocked()){
    alert(lockMsg());
    return;
  }
  const email = (document.getElementById("user").value||"").trim();
  const pass  = (document.getElementById("pass").value||"").trim();

  if(!email || !pass){ alert("Preencha email e senha."); return; }

  try{
    await signInWithEmailAndPassword(auth, email, pass);
    resetAttempts();
  }catch(e){
    console.warn(e);
    const l = getLock();
    const attempts = (l.attempts||0) + 1;
    // bloqueio 15 minutos ap√≥s 3 tentativas
    if(attempts >= 3){
      setLock({attempts, until: now() + 15*60*1000});
      alert("Muitas tentativas. Bloqueado por 15 minutos.");
    }else{
      setLock({attempts, until: 0});
      alert("Login inv√°lido. Tentativas: " + attempts + "/3");
    }
  }
}

async function sair(){
  await signOut(auth);
}

function setUI(user){
  if(user){
    pill.textContent = "‚úÖ logado: " + user.email;
    loginCard.style.display="none";
    panelCard.style.display="";
  }else{
    pill.textContent = "üîí desconectado";
    loginCard.style.display="";
    panelCard.style.display="none";
  }
}

async function carregarProdutos(){
  const box = document.getElementById("prodCards");
  if(!box) return;
  box.innerHTML = "";

  const snap = await getDocs(query(collection(db,"produtos"), orderBy("ord","asc"), limit(500)));
  const all = snap.docs.map(d=>({docId:d.id, ...d.data()}));

  // contadores
  const cp = document.getElementById('countProdutos');
  if(cp) cp.textContent = `(${all.length})`;

  // filtros
  const q = (document.getElementById("qBusca")?.value || "").trim().toLowerCase();
  const qCat = (document.getElementById("qCat")?.value || "").trim().toLowerCase();
  const qAtivo = (document.getElementById("qAtivo")?.value || "TODOS");

  const filtrado = all.filter(p=>{
    const nome = String(p.nome||"").toLowerCase();
    const cat = String(p.cat||"").toLowerCase();
    const ativo = (p.ativo !== false); // padr√£o: ativo
    if(q && !nome.includes(q)) return false;
    if(qCat && !cat.includes(qCat)) return false;
    if(qAtivo==="ATIVOS" && !ativo) return false;
    if(qAtivo==="INATIVOS" && ativo) return false;
    return true;
  });

  filtrado.forEach(p=>{
    const foto = p.fotoURL || "";
    const nome = p.nome || "";
    const cat  = p.cat || "";
    const preco = Number(p.preco||0);
    const ativo = (p.ativo !== false);

    const card = document.createElement("div");
    card.className = "prodCard";
    card.innerHTML = `
      ${foto ? `<img class="prodImg" src="${foto}" alt="foto">` : `<div class="prodImg"></div>`}
      <div class="prodPad">
        <div class="prodTop">
          <div>
            <div class="prodName">${nome}</div>
            <div class="prodMeta">ID: ${p.docId} ‚Ä¢ ${cat}</div>
          </div>
          <div class="prodPrice">R$ ${preco.toFixed(2)}</div>
        </div>

        <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
          <span class="statusP ${ativo ? "on" : "off"}">${ativo ? "‚úÖ Ativo" : "‚õî Inativo"}</span>
          <button class="btn ghost sm" onclick="window.__toggleAtivo('${p.docId}', ${ativo ? "true" : "false"})">${ativo ? "Desativar" : "Ativar"}</button>
        </div>

        <div class="prodActions">
          <button class="btn ghost sm" onclick="window.__edit('${p.docId}')">Editar</button>
          <button class="btn ghost sm" onclick="window.__del('${p.docId}')">Excluir</button>
        </div>
      </div>
    `;
    box.appendChild(card);
  });

  window.__toggleAtivo = async (id, atual)=>{
    try{
      await updateDoc(doc(db,"produtos", String(id)), {ativo: !atual});
      await carregarProdutos();
    }catch(e){
      console.error(e);
      alert("Erro ao alterar ativo. Verifique Rules.");
    }
  };

  window.__del = async (id)=>{
    if(!confirm("Excluir produto "+id+"?")) return;
    await deleteDoc(doc(db,"produtos", String(id)));
    await carregarProdutos();
  };

  window.__edit = async (id)=>{
    const snap2 = await getDocs(query(collection(db,"produtos"), orderBy("ord","asc"), limit(500)));
    const docx = snap2.docs.find(x=>x.id===id);
    const p = docx?.data() || {};
    document.getElementById("pId").value = id;
    document.getElementById("pCat").value = p.cat||"";
    document.getElementById("pNome").value = p.nome||"";
    document.getElementById("pPreco").value = p.preco||"";
    document.getElementById("pFotoURL").value = p.fotoURL||"";
    document.getElementById("pAtivo").checked = (p.ativo !== false);
    document.getElementById("pOrd").value = p.ord ?? "";
    window.scrollTo({top:0,behavior:"smooth"});
  };
}

async function salvarProduto(){
  const u = auth.currentUser;
  if(!u){ alert("Fa√ßa login."); return; }
  const email = String(u.email||"").toLowerCase();
  const ok = (ADMIN_EMAILS||[]).map(x=>String(x||"").toLowerCase()).includes(email);
  if(!ok){
    alert("Este email n√£o √© admin. Ajuste ADMIN_EMAILS no firebase-config.js.");
    return;
  }

  const id = String((document.getElementById("pId").value||"").trim());
  const cat = (document.getElementById("pCat").value||"").trim() || "Sopas";
  const nome = (document.getElementById("pNome").value||"").trim();
  const preco = parseFloat(String(document.getElementById("pPreco").value||"").replace(",","."));
  const fotoURL = (document.getElementById("pFotoURL").value||"").trim();
  const ord = parseInt(document.getElementById("pOrd").value||"0",10) || 999;

  if(!id || !/^[0-9]+$/.test(id)) return alert("ID deve ser num√©rico (ex: 101).");
  if(!nome) return alert("Informe o nome.");
  if(!Number.isFinite(preco)) return alert("Pre√ßo inv√°lido.");

  // valida√ß√£o simples do link (opcional)
  if(fotoURL && !/^https?:\/\//i.test(fotoURL)){
    return alert("O link da foto deve come√ßar com http:// ou https://");
  }

  const ativo = !!document.getElementById("pAtivo").checked;
  await setDoc(doc(db,"produtos", id), {cat, nome, preco, ord, fotoURL, ativo}, {merge:true});
  alert("Salvo!");
  await carregarProdutos();
}

async function carregarPedidos(){
  const tb = document.getElementById("tbPed");
  tb.innerHTML="";
  // √∫ltimos 120 pedidos
  const snap = await getDocs(query(collection(db,"pedidos"), orderBy("criadoEm","desc"), limit(120)));
  snap.forEach(d=>{
    const p = d.data();
    const dt = p.criadoEm?.toDate ? p.criadoEm.toDate() : null;
    const data = dt ? dt.toLocaleString("pt-BR") : "";
    const nome = p.cliente?.nome || "";
    const total = Number(p.total||0).toFixed(2);
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><small>${data}</small></td>
      <td>${nome}<br><small>${p.cliente?.tel||""}</small></td>
      <td>R$ ${total}</td>
      <td><small>${p.entregaTipo||""}</small></td>
      <td><small>${(p.obs||"").slice(0,40)}</small></td>
    `;
    tb.appendChild(tr);
  });
}

async function exportarCSV(){
  const snap = await getDocs(query(collection(db,"pedidos"), orderBy("criadoEm","desc"), limit(500)));
  const rows = [["id","data","cliente_nome","cliente_tel","cliente_endereco","tipo","metodo","subtotal","total","obs","itens"]];
  snap.forEach(d=>{
    const p = d.data();
    const dt = p.criadoEm?.toDate ? p.criadoEm.toDate().toISOString() : "";
    const itens = (p.itens||[]).map(i=>`${i.nome} x${i.qtd} (${(Number(i.preco||0)*Number(i.qtd||0)).toFixed(2)})`).join(" | ");
    rows.push([
      d.id, dt, p.cliente?.nome||"", p.cliente?.tel||"", p.cliente?.endereco||"",
      p.entregaTipo||"", p.metodo||"", p.subtotal||0, p.total||0, (p.obs||""), itens
    ]);
  });
  const csv = rows.map(r=>r.map(x=>('"'+String(x??"").replace(/"/g,'""')+'"')).join(";")).join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "pedidos_sabor_da_sopa.csv";
  a.click();
  URL.revokeObjectURL(a.href);
}

window.entrar = entrar;
window.sair = sair;
window.salvarProduto = salvarProduto;
window.exportarCSV = exportarCSV;

function showView(v){
  const vp = document.getElementById("viewProdutos");
  const ve = document.getElementById("viewPedidos");
  const np = document.getElementById("navProdutos");
  const ne = document.getElementById("navPedidos");
  if(v==="pedidos"){
    vp?.classList.add("hide");
    ve?.classList.remove("hide");
    np?.classList.remove("active");
    ne?.classList.add("active");
  }else{
    ve?.classList.add("hide");
    vp?.classList.remove("hide");
    ne?.classList.remove("active");
    np?.classList.add("active");
  }
  toggleSide(false);
}
function toggleSide(open){
  const side = document.getElementById("side");
  const ovl  = document.getElementById("ovl");
  if(!side || !ovl) return;
  if(open){
    side.classList.add("open");
    ovl.classList.add("show");
  }else{
    side.classList.remove("open");
    ovl.classList.remove("show");
  }
}
window.showView = showView;
window.toggleSide = toggleSide;

function hookFiltros(){
  const ids = ["qBusca","qCat","qAtivo"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    el.addEventListener("input", ()=>carregarProdutos());
    el.addEventListener("change", ()=>carregarProdutos());
  });
}
window.hookFiltros = hookFiltros;

onAuthStateChanged(auth, async (user)=>{
  setUI(user);
  showLockUI();
  if(!user) return;
  // carrega dados
  await carregarProdutos();
  hookFiltros();
  await carregarPedidos();
});
</script>
</body>
</html>
